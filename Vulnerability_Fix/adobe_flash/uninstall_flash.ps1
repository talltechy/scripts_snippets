# Uninstall all versions of Adobe Flash Player

# Ensure the script is running with administrative privileges
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Error "This script must be run as an administrator."
    exit 1
}

# Get list of installed Adobe Flash Player versions
$flashPlayers = Get-CimInstance -Query "SELECT * FROM Win32_Product WHERE Name LIKE 'Adobe Flash Player%'" -ErrorAction SilentlyContinue

if ($flashPlayers) {
    foreach ($flashPlayer in $flashPlayers) {
        try {
            # Uninstall each version
            $flashPlayer.Uninstall() | Out-Null
            Write-Output "Uninstalled: $($flashPlayer.Name)"
        } catch {
            Write-Error "Failed to uninstall: $($flashPlayer.Name)"
        }
    }
} else {
    Write-Output "No Adobe Flash Player installations found."
}

# Additional cleanup if necessary
try {
    Remove-Item -Path "C:\Windows\System32\Macromed\Flash" -Recurse -Force -ErrorAction SilentlyContinue
    Write-Output "Removed: C:\Windows\System32\Macromed\Flash"
} catch {
    Write-Error "Failed to remove: C:\Windows\System32\Macromed\Flash"
}

try {
    Remove-Item -Path "C:\Windows\SysWOW64\Macromed\Flash" -Recurse -Force -ErrorAction SilentlyContinue
    Write-Output "Removed: C:\Windows\SysWOW64\Macromed\Flash"
} catch {
    Write-Error "Failed to remove: C:\Windows\SysWOW64\Macromed\Flash"
}
